<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Park</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script>
        var duration = 0;
        var date = new Date();
        function updateTime() {
            date = new Date();
            document.getElementById('time').innerText = "当前时间：" + dateToString(date);
        }
        function park(element) {
            duration = parseInt(document.getElementById('duration').value);
            if (!duration) {
                duration = 0;
            }
            alert('成功停车:' + duration + 'h')
            element.innerText = "Confirm modification!";

            var p1 = document.createElement("p")
            p1.innerText = "预计停放时间：" + duration + 'h'
            p1.id = 'durationLabel'
            var p2 = document.createElement("p")
            p2.innerText = "预计离开时间：" + dateToString(new Date(date.getTime() + duration * 3600 * 1000))
            p2.id = 'leaveTimeLabel'
            document.getElementById('state').parentNode.appendChild(p1);
            document.getElementById('state').parentNode.appendChild(p2);

            document.getElementById('state').parentNode.removeChild(document.getElementById('state'));
            document.getElementById('scan').parentNode.removeChild(document.getElementById('scan'));

            element.onclick = changeDuration;
        }
        function changeDuration() {
            duration = parseInt(document.getElementById('duration').value);
            if (!duration) {
                duration = 0;
            }
            alert("停车时间修改为：" + duration + 'h');
            document.getElementById('durationLabel').innerText = "预计停放时间：" + duration + 'h'
            document.getElementById('leaveTimeLabel').innerText = "预计离开时间：" + dateToString(new Date(date.getTime() + duration * 3600 * 1000))
        }
        function dateToString(_date) {
            console.log(_date);
            return _date.getMonth() + "/" + _date.getDate() + " " + _date.toLocaleTimeString()
        }
    </script>

</head>

<body>
    <div class="mainbody">
        <nav>
            <a href="./myreservation.html">My Parking Place</a> 
            <a href="./park.html" class="active">Park</a> 
            <a href="./leave.html">Leave</a> 
            <a href="./login.html" style="float: right;">Logout</a>
        </nav>
        <div class="PMessbox">
            <p>Selected parking spaces：</p>
            <p>A06</p>
            <p id='state'>Status： Available </p>
            <p id="time">Time：6/17 上午11:50:19</p>
        </div>
        <div style="text-align: center;">
        Parking time : <input id='duration' type="text" id="username" style="width: 80px;height: 30px;border: 1px solid #A6A6A6;border-radius: 5px;padding-left: 10px;"> hour(s)<br>
        </div>
        <div>
        <button class="button1 button2" onclick="park(this)" style="display: block; margin:auto;">
            Confirm parking!
        </button>
        </div>
        <div>
        <button id='scan' onclick="updateTime()"
            style="width: 120px;height:120px;background: url('./css/scanQRcode.PNG') no-repeat center;display: block; margin:auto;">
        </button>
        </div>
    </div>
</body>

</html>